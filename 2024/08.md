# 2024/08 学習記録

**基本スケジュール**
*  ひとまず課題を終わらせる
*  「基本情報技術者」「プリンシプルオブプログラミング」書籍を読む
*   「JavaScript データ・アルゴリズム課題」を復習として最低3問解く

**今月目標**

* Express (Web API CRUD 課題)を完了させる
* 過去の課題の復習を毎日取り組む

***

## 2024/08/1
- ステップ3 認証/認可の実装のFB対応
     -  エラーの処理について
         -  ユーザー情報の取得部分で500エラーを対応したところを明日FBもらう
- ステップ4 その他のエンドポイントの実装
     -  API仕様書を元にその他のエンドポイントの実装
     -  やっぱりユーザー情報のPOSTでもpassport（jwt）による認証は通すということ・・・？
     -  ユーザー情報のPOSTをしてみたけどforeignKeyに指定しているuserIdがnullに・・・
         -  Associationsの指定がおかしい気がする
         -  SequelizeのAssociationsドキュメントを参考に
         -  テーブル定義所を元にまた図を書く
- プリンシプルオブプログラミングの「カプセル化」を読む
     -  カプセル化とは
     -  関連性のあるデータ・ロジックをグルーピングしたモジュール
     -  メリット
         -  関連のない要素が混じらないことでコードが見やすい
         -  変更時の影響がモジュール内に閉じる
         -  純粋で質の良いモジュールができる

### メモ
-  今日から8月
-  来月から新しい挑戦が始まる
-  今月は事前準備を進めたい

***

## 2024/08/2
- ステップ3 認証/認可の実装のFB
     -  エラーの処理について
         -  ユーザー情報の取得部分で不要なnext()のエラーの処理を削除
     -  JWTの有効期限が切れた後問題について
         -  今回の課題ではそこまではしないけど「Refresh Token」で対応する
         -  Refresh Token ： JWTのトークンとは別のトークンを保存してログインし直す（ユーザーからは常にログインしているように見える）
     -  そもそもなぜ有効期限を設定するのか
         -  クロスサイトスクリプティングなどの問題を防ぐため
- ステップ4 その他のエンドポイントの実装のFB
     -  ユーザー情報のPOSTをしてみたけどforeignKeyに指定しているuserIdがnullに・・・
         -  そもそもnullで登録できているのがおかしい
     -  Varidationの設定をする
         -  varidation : DBの検証・制約・チェックの設定
         -  DBにデータを入れたり、更新を行う時に必ず行う
         -  DBをきれいにしておかないと事故が起きる
         -  DBは基本NULLを許容しないように心がける
         -  NotNullのところにNullを入れてしまうとDB側のエラーになる＝エラーの予測ができない
     -  FB対応
         -  一旦Varidationを設定してみたけど
         -  foreignKeyと紐づいた要素を取ってこようとするとエラーが
         -  Error: A column called 'id' was added to the attributes of 'Users' but not marked with 'primaryKey: true'
         -  primaryKey: trueを指定しろということなのか（指定してる）
- エラーについて
     -  スタックトレース
         -  エラーが発生した際に、直前に実行した関数やメソッドなどの履歴を表示する
         -  バックエンドをやる上で重要だから読めるようにしておく
### メモ
-  将来的にjavaScriptだけでなく他にも対応できる言語を増やしていきたい

***

## 2024/08/3
- ステップ4 その他のエンドポイントの実装のFB
     -  ユーザー情報のPOSTをしてみたけどforeignKeyに指定しているuserIdがnullになる問題
         -  間違えてmigrationに設定していたValidationをmodelに移す
         -  公式ドキュメントにValidationにForeignKeyの設定をしているのを発見してとりあえずやってみる
         -  型のエラーが頻繁に出ているのでドキュメントのTypeScriptのページを上から順番に読む
         -  投稿ページのpostの処理にuserDBのidを取得しようとすると
         -  「プロパティ 'id' は型 'User' に存在しません。」となる
         -  class Userに指定したidの型ではだめなのか
     -  Sequelizeの型付けについて
         -  InferAttributes・InferCreationAttributes
         -  これらを使用して、モデルから直接属性の型付けを抽出する
         -  InferAttributesで除外の設定ができる（infoerAttributes<User,{omit:'properties'|'to'|'omit'}>）
         -  CreationOptional: フィールドをオプションとしてマークするタイプ（モデルのインスタンスを作成するとき（create）など）
         -  ↑Nullかundefinedを受け入れる属性には使用しない
         -  autoIncrementを使用する場合、idを未定義にすることができる
### メモ
-  うまくいかず・・見逃しているところがありそう
-  tsエラーでハマりがち

***

## 2024/08/4
- ステップ4 その他のエンドポイントの実装
     -  ユーザー情報のPOSTをしてみたけどforeignKeyに指定しているuserIdがnullになる問題の続き
         -  Associationsのところを見直してmodelを修正
         -  hasManyの記述にforeignKey/sourceKey/constraintsを追加
         -  ↑それが原因かPOSTした情報にいつのまにか「UserId」が追加されている
         -  foreignKeyの指定は「userId」にしているのになぜ・・・
         -  hasManyされる側（Post）のbelongsToにも同じように追加するとエラー
         -  Error: Post.belongsTo called with something that's not a subclass of Sequelize.Model
- tsでよく見る「?」とか「!」について調べる
     -  オプションパラメーター（?）
         -  引数に指定すると省略可能になる
         -  必ず引数の最後に書く
     -  オプショナルチェイング（?.）
         -  nullやundefinedのプロパティに . で参照しても（?.）を使用するとエラーにならず
         -  undefinedが返る
     -  Null合体演算子（??）
         -  左辺がnullかundefinedの場合に右の値を返し
         -  それ以外は左の値を返す
     -  Null合体代入演算子（??=）
         -  左辺がnullかundefinedの場合に代入する
     -  非Nullアサーション演算子（!）
         -  null許容型（T|nullがT|null|undefined）に対して
         -  （!）を使用することで（T）型になる
         -  （T）はNullable型のこと
     -  そもそも型アサーションとは（TypeAssertion）
         -  型を上書きする
         -  プロパティがゼロ（空）の要素はエラーになるが
         -  Error: property '⚪︎⚪︎' does not exist on '⚪︎⚪︎';
         -  型アサーション「as ⚪︎⚪︎」で修正できる
     -  アサーションを使用するには注意が必要
         -  レガシーのコードを簡単に移行できて便利だけど
         -  必要なプロパティを追加し忘れてもコンパイラは守ってくれない
- 静的フィールドとは
     -  static field
     -  クラスのプロパティ
     -  通常のフィールドはインスタンスのプロパティ
     -  JavaScriptではクラスのプロパティに後から値を代入して対応
     -  tsでは「static」キーワードを用いる
### メモ
-  今日は子供と美大のワークショップに参加しました
-  デザインについて考えながら楽しく参加できて良かった

***

## 2024/08/5
- ステップ4 その他のエンドポイントの実装
     -  ユーザー情報のPOSTをしてみたけどforeignKeyに指定しているuserIdがnullになる問題の続き
         -  どうしてもtsエラーが解消できないし
         -  req.userまでは取得できるのにreq.user.idだとundefinedになる現象を相談
         -  passport側ですでにUserインターフェイスが宣言されているのが原因だった
         -  インターフェイスの上書きの方法を教えてもらう
         -  いろいろエラーが出る・・・
         -  前回のオーバーロードにより、次のエラーが発生しました。とか
         -  パラメーター 'req' および 'req' は型に互換性がありません。
         -  一旦reqの型をanyにすることで解消🙌
         -  記事一覧の取得のクエリパラメータ絞り込み機能の実装完了🙌
         -  ユーザー記事一覧取得とクエリパラメータ絞り込み機能の実装完了🙌
         -  その他、ユーザの投稿一覧・記事詳細・記事更新・記事削除が残っている
     -  expressでのクエリパラメータの取得について調べる
         -  req.query.dummy
### メモ
-  約4日間悩んで心折れかけたけど解消してよかった
-  TypeScriptについても少し理解が深まった（まだまだ覚えることありそう）
-  解消してから他のエンドポイントの対応が続々進む

***

## 2024/08/6
- ステップ4 その他のエンドポイントの実装
     -  ユーザー情報のPOSTをしてみたけどforeignKeyに指定しているuserIdがnullになる問題の続き
         -  投稿時にカテゴリーの情報も取得する実装完了🙌
         -  カテゴリーのIDは中間テーブルにレコードが入る予定だけど
         -  中間テーブルのデータが渡っていないということはAssociationsの指定がおかしいのか
### メモ
-  今日は出社しました

***

## 2024/08/7
- ステップ4 その他のエンドポイントの実装FB
     -  コントローラー部分にロジックを書きすぎてファットコントローラーになっている様子
         -  できるだけModelに書くのが望ましい
         -  Controllerは薄く保つ
         -  ビジネスロジックはModelに切り出す
         -  ControllerはModelとViewの操作だけを記述、肥大化を避ける
- ファットコントローラについて
     -  [【Rails】なぜファットコントローラを避けるべきなのか？腹落ちするまで向き合ってみた](https://zenn.dev/linkedge/articles/9e924c18e702d2)
     -  可読性
         -  どこにどの処理を書いたのがわかりにくい
         -  共通化すべきエラーハンドリングも各アクションごとに例外処理を実装してコードが冗長化してしまう
     -  保守性
         -  同じ処理を至る所に書いているケースがあり改修漏れが発生しやすい
         -  処理の一部のコードを修正すると他の部分に影響が出てしまいやすい
     -  DRY原則
         -  情報を重複させない
### メモ
-  今日も出社しました
-  明日は合間に課題を進めたい

***

## 2024/08/8
- ステップ4 その他のエンドポイントの実装FB対応
     -  コントローラーの記述をできるだけModelへ移植してファットコントローラー解消
         -  一旦分けられそうな処理を移植してみたものの
         -  調べた感じだと処理ごとにコントローラーのファイルを分けている例もあった
     -  中間テーブルのValidation
         -  中間テーブルの場合自動的にデータが入る？からValidationをどこまで設定すればよいのか
         -  ひとまず「notNull」を設定
     -  不要な分岐を削除
         -  返り値を調べてからデータ取得の処理を考えよう
### メモ
-  今日は夜に地元のお祭りへ
-  あと1週間と少しで今の課題を終わらせなければ・・

***

## 2024/08/9
- ステップ4 その他のエンドポイントの実装FB
     -  ファットコントローラーに関して
         -  関数ではなくインスタンスメソッドで対応する
         -  オブジェクト指向の考え方に慣れる
     -  中間テーブルにデータが入らない件
         -  sequelizeのcreating width Associationsを確認する
     -  FB対応
         -  いろいろ試していて、モデルの同期「.sync」をやったら大変なことに・・・
         -  中間テーブル「post_categories」の他に「PostCategories」テーブルが出現
         -  「PostCategories」のStructureを確認すると
         -  ForeignKeyが設定されている！
         -  中間テーブルの名前の設定が間違えている？
         -  一旦元の状態に戻そうと（PostCategoriesを削除）したら消せず
         -  ERROR: Cannot drop table 'categories' referenced by a foreign key constraint 'postcategories_ibfk_1' on table 'PostCategories'.
         -  chatgptとドキュメントを調べまくって
         -  migrationをいろいろいじってなんとか復活・・・
- sequelizeのモデルインスタンスについて確認
     -  インスタンスの作成
         -  「build」： マップでできるオブジェクトのみを生成する（DBと通信しない・非同期でもない）
         -  「sava」: buildのインスタンスを実際にDBに保存する
         -  「create」: 「build」・「save」の機能を組み合わせた便利メソッド
     -  インスタンスの更新
         -  フィールドの値を変更した場合「save」を再度呼び出す
         -  「set」メソッドで一度に複数のフィールドを更新できる
     -  インスタンスの削除
         -  「destroy」を呼び出す
- TypeScriptについて
     -  [サバイバルTypeScript](https://typescriptbook.jp/)
     -  ↑時間を作ってやってみる
### メモ
-  全てにおいて、自分の欲しい情報を正確にとれるように意識することで問題解決能力が上がる
-  問題に直面して詰まった時は、一度問題から離れて簡単な基礎を作ってみる（ドキュメントの自分の見ていないところを見直す）
-  実務でレビューをもらったときに、優先順位を考えて対応する（まず形にすることも大事）
-  一瞬テーブルがめちゃくちゃになって死ぬかと思った

***

## 2024/08/10
- ステップ4 その他のエンドポイントの実装FB
     -  ファットコントローラ対応
         -  オブジェクト指向について見直してから
         -  自分なりにインスタンスメソッドを一応やってみる
         -  以下のエラーがでて、「categoryId」が「PostCategoryId」になってしまう
         -  original: Error: Unknown column 'PostCategoryId' in 'field list'
         -  関連付けの設定が間違っているらしいけど間違いが発見できず
- オブジェクト思考について調べる
     -  [JavaScript Primer クラス](https://jsprimer.net/basic/class/)
     -  構造・動作・状態を定義できる
     -  インスタンス（オブジェクト）を作成できる
         -  クラスに定義した動作を継承・状態は動作によって変化する
     -  クラスの定義
         -  「Class構文」を使う
         -  クラス宣言分
         -  クラス式
         -  の二種類定義方法がある
         -  クラスは関数として呼び出すことができない
         -  MyClass();　← ×
     -  コンストラクタ
         -  クラスは必ずコンストラクタを持つ
         -  クラスからインスタンスを作成する時にインスタンスに関する状態の初期化を行う
         -  「constructor」メソッドで定義
         -  定義した処理はインスタンス化した時に自動的に呼ばれる
         -  処理がない時は省略できる
         -  コンストラク内の「this」はこれから新しく作るインスタンスオブジェクト
     -  クラスのインスタンス化
         -  「new 演算子」でインスタンスオブジェクトを作成できる
         -  「new 演算子」は引数を渡せる→コンストラクタ関数の仮引数に渡される
         -  クラス名は「大文字」はじまり・インスタンス名は「小文字」はじまり
     -  クラスのプロトタイプメソッドの定義
         -  クラスの動作をメソッドで定義（コンストラクタのメソッドとは別）
         -  メソッドからインスタンスを参照するには「this」をつかう
     -  クラスのアクセッタプロパティの定義（getter・setter）
         -  プロパティの参照（getter）
         -  プロパティの代入（setter）
         -  ↑この時に呼び出される特殊なメソッド＝「アクセッタプロパティ」
         -  メソッド名の前に「get」か「set」をつける
     -  静的メソッド
         -  クラスをインスタンス化せずに（newしない）利用できるメソッド（クラスメソッド）
         -  静的メソッドでの「this」はクラス自身を参照する
         -  インスタンスは参照できない
### メモ
-  解決できない問題と今月中に終わらせたくて焦っていて逆に進まない状態だったけど
-  一旦基礎に返り
-  苦手なオブジェクト指向について調べたら
-  ドキュメントを読む時に前より内容が頭に入るようになった

***

## 2024/08/11
- ステップ4 その他のエンドポイントの実装FB
     -  ファットコントローラ対応
     -  Associationの設定見直し
         -  関連付けのエラーは解消できたけど
         -  関連の設定が間違っているからかジャンクションテーブルが反映されない
- SequelizeのAssociationについて見直す
     -  4種の関連付け
         -  HasOne/BelongsTo/HasMany/BelongsToMany
     -  ↑を組み合わせた3つ
         -  One-to-One （hasOne・belongsTo）
         -  One-to-Many （hasMany・belongsTo）
         -  Many-to-Many （belongsToManyを2つ同時に設定）
     -  定義の順番が重要
         -  A.hasOne(B,{option}) : A・BにOne-to-One / 外部キーは(B)
         -  A.belongsTo(B) : A・BにOne-to-One / 外部キーは(A)
         -  A.hasMany(B) : A・Bに一対多 / 外部キーは(B)
         -  A.belongsToMany(B,{through:'C') : A・BにMany-to-Many / Cは接合テーブル←自動的に作成
     -  関連付けのFetching EagerLoading/LazyLoading
         -  LazyLoading : 必要な時だけ関連データをフェッチする（条件がある時）
         -  EagerLoading : 最初から全てを一度にフェッチする
### メモ
-  解決できない・・・
-  明日はAssociationのドキュメントの続きをみよう

***

## 2024/08/12
- ステップ4 その他のエンドポイントの実装FB
     -  ファットコントローラ対応
     -  Associationの設定見直し
         -  関連付けのエラーは解消できたけど
         -  関連の設定が間違っているからかジャンクションテーブルが反映されない
     -  その他のエンドポイントの処理追加
         -  ハマりすぎて心が折れかけなので他の処理も進めてみる
         -  /posts/:idのgetの処理（カテゴリー情報の取得以外）
         -  /posts/:idのdeleteの処理
         -  /posts/:idのpatchの処理
- SequelizeのBasicを見直し
     -  DBに接続するには「Sequelizeインスタンス」を作成する
         -  const sequelize = new Sequelize(...
     -  接続のテスト
         -  .authenticate()
     -  Model.initで定義した属性は・getter/・setterを追加する
     -  public class field（class User extends Model {の中の記述}）
         -  モデルの属性の1つと同じ名前のpublic class fieldを追加すると問題が発生する
         -  ↑TypeScriptでは「declare」を使用することでpublic class fieldを追加せず型情報を追加できる
### メモ
-  いつか解決できる日が来るのか・・
-  他のエンドポイントの処理がざっくりできたから
-  残りのハマっている処理に集中できる

***

## 2024/08/13
- ステップ4 その他のエンドポイントの実装FB
     -  ファットコントローラ対応
     -  Associationの設定見直し
         -  関連の設定が間違っているからかジャンクションテーブルが反映されない
     -  その他のエンドポイントの処理追加
         -  ユーザーの投稿ページのget処理をインスタンスメソッドへ変更
- SequelizeのBasicを見直し
     -  モデルの同期
         -  model.sync(options)を呼び出すと同期できる
         -  User.sync() : テーブルが存在しない場合は作成する（すでに存在する時は何もしない）
         -  User.sync({force:true}) : テーブルを作成する。既にある場合は最初に削除する。（破壊的な操作で実稼働レベルのソフトウェアには推奨されない）
         -  User.sync({alter:true}) : DB内のテーブルの状態を確認してモデルと一致するように変更を実行する
     -  データ型
         -  モデルで定義する全ての列にはデータ型が必要
         -  Sequelizeの「組み込みデータ型」が用意されている（DataTypes）
### メモ
-  明日から有休消化・・人に恵まれた良い会社だった
-  まずは課題を終わらせて、次の準備を進めないと

***

## 2024/08/14
- ステップ4 その他のエンドポイントの実装FB
     -  ファットコントローラ対応
     -  Associationの設定見直し
     -  ↑上記以外の実装のFBをいただく
- インスタンスメソッドとクラスメソッドの違いを再確認
     -  まだ理解が足りていない気がする
     -  インスタンスメソッド
         -  new演算子でインスタンス化したオブジェクトに関連付けられている
         -  例） class MyClass
         -  instance_method()
         -  my_object = MyClass.new （my_object.instance_methodで呼び出し）
     -  クラスメソッド（静的メソッド）
         -  クラス自体に関連する
         -  クラス全体に影響を与える操作を提供する
         -  例） class MyClass
         -  class_method()
         -  （MyClass.class_methodで呼び出し）
- ステータスコードについて
     -  [HTTPステータスコード 完全に理解した](https://qiita.com/unsoluble_sugar/items/b080a16701946fcfce70)
     -  まだ曖昧なエラーハンドリング時の適したステータスコードについて調べる
         -  200番台・・成功
         -  300番台・・リダイレクト
         -  400番台・・クライアントエラー
         -  500番台・・サーバーエラー
### メモ
-  有休消化期間なものの
-  子供が夏休みだから学習時間の捻出に苦戦中
-  いかに朝早く起きるかが勝負

***

## 2024/08/15
- ステップ4 その他のエンドポイントの実装FB
     -  インスタンスメソッドにできていなかったところの修正
         -  ↑の修正でまたファットコントローラーになっているような気も・・・
         -  引数にreqを指定していたところを修正＝reqオブジェクトに依存してしまうから
     -  ジャンクションテーブルのデータの連携できた🙌
         -  ジャンクションテーブルをcreateするという発想がなかった・・・
     -  残りは明日の朝以下を完了させたい
         -  全体的にトランザクションの処理を入れる
- オブジェクト指向について見直し（再）
     -  クラスメソッドとインスタンスメソッドの違いについて何個かyoutube動画を確認
     -  クラス・・・特定のオブジェクトの「設計図」
     -  メソッド・・・処理や振る舞いを定義
     -  インスタンスメソッド
         -  クラスから生成されたインスタンスに対して呼び出される
- Sequelizeのtransactions（トランザクション）
     -  デフォルトでは使用しない
     -  本番環境でSequelizeを使用する時は必ずトランザクションを使用する構成にする
     -  DBの操作を一時的に保留→全ての操作が成功→コミット（確定）　＝　データの生合成を保つ
     -  「管理されたトランザクション」
         -  開始と終了が自動的に管理される
         -  関数内で使用：トランザクションが終了するまでの一連のDB操作を非同期関数として指定
         -  ↑でエラーが発生した場合、地頭的にロールバックされる
         -  トランザクションの全ての操作を一括して管理したい場合に適している
     -  「管理されていないトランザクション」
         -  トランザクションの開始、コミット、ロールバックを手動で管理
         -  トランザクションの開始から終了までの制御を細かく行うことができる
         -  トランザクションの終了を忘れると接続が保持されてしまう
         -  トランザクションの中で条件に応じてコミットやロールバックのタイミングを柔軟に制御したい場合に適している
     -  「ロールバック」
         -  トランザクションの処理の中でエラーが発生した場合にトランザクション内で行われた全ての変更を取り消して開始前に戻す

### メモ
-  何とか間に合うかもしれない・・
